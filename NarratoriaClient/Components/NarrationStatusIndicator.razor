@implements IDisposable

<div class="narration-status @_statusClass @CssClass">
    @_message
</div>

@code {
    [Inject] private INarrationService NarrationService { get; set; } = default!;

    [Parameter] public string? CssClass { get; set; }

    private string _message = "Narrator is ready.";
    private string _statusClass = "status-idle";

    protected override void OnInitialized()
    {
        NarrationService.StatusChanged += HandleStatusChanged;
    }

    private void HandleStatusChanged(object? sender, NarrationStatusChangedEventArgs args)
    {
        _ = InvokeAsync(() =>
        {
            _message = args.Message;
            _statusClass = args.Status switch
            {
                NarrationStatus.Connecting => "status-connecting",
                NarrationStatus.Writing => "status-writing",
                NarrationStatus.Disconnected => "status-disconnected",
                _ => "status-idle"
            };
            StateHasChanged();
            return Task.CompletedTask;
        });
    }

    public void Dispose()
    {
        NarrationService.StatusChanged -= HandleStatusChanged;
    }
}
