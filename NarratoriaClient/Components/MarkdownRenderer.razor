@using Markdig

<div class="@CssClass" @attributes="AdditionalAttributes">
    @(_renderedContent)
</div>

@code {
    [Parameter] public string? Content { get; set; }
    [Parameter] public string? CssClass { get; set; }
    [Parameter] public bool EnableHtml { get; set; }
    [Parameter(CaptureUnmatchedValues = true)] public Dictionary<string, object>? AdditionalAttributes { get; set; }

    private MarkupString _renderedContent;
    private MarkdownPipeline _pipeline = default!;

    protected override void OnInitialized()
    {
        var builder = new MarkdownPipelineBuilder().UseAdvancedExtensions();
        if (!EnableHtml)
        {
            builder.DisableHtml();
        }

        _pipeline = builder.Build();
        UpdateContent();
    }

    protected override void OnParametersSet()
    {
        UpdateContent();
    }

    private void UpdateContent()
    {
        var markdown = Content ?? string.Empty;
        var html = Markdig.Markdown.ToHtml(markdown, _pipeline);
        _renderedContent = new MarkupString(html);
    }
}
