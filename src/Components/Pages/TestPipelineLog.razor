@page "/test-pipeline-log"
@using System.Collections.Immutable
@using Narratoria.Components

<h1>Test Pipeline Log</h1>

<NarrationPipelineLog Turns="@_turns" StageOrder="@_stageOrder" OnSubmitPrompt="OnSubmit" IsSubmitting="false" />

@code {
    private readonly IReadOnlyList<NarrationStageKind> _stageOrder = new[]
    {
        NarrationStageKind.Sanitize,
        NarrationStageKind.Context,
        NarrationStageKind.Lore,
        NarrationStageKind.Llm
    };

    private IReadOnlyList<NarrationPipelineTurnView> _turns = new[]
    {
        new NarrationPipelineTurnView
        {
            TurnId = Guid.NewGuid(),
            UserPrompt = "I wait for the others in the tavern.",
            Stages = ImmutableArray.Create(
                new NarrationStageView{ Kind = NarrationStageKind.Sanitize, Status = NarrationStageStatus.Completed },
                new NarrationStageView{ Kind = NarrationStageKind.Context, Status = NarrationStageStatus.Completed },
                new NarrationStageView{ Kind = NarrationStageKind.Lore, Status = NarrationStageStatus.Completed },
                new NarrationStageView{ Kind = NarrationStageKind.Llm, Status = NarrationStageStatus.Completed }
            ),
            Output = new NarrationOutputView{ FinalText = "The tavern hums with low conversation..." }
        },
        new NarrationPipelineTurnView
        {
            TurnId = Guid.NewGuid(),
            UserPrompt = "I scan the room for familiar faces.",
            Stages = ImmutableArray.Create(
                new NarrationStageView{ Kind = NarrationStageKind.Sanitize, Status = NarrationStageStatus.Completed },
                new NarrationStageView{ Kind = NarrationStageKind.Context, Status = NarrationStageStatus.Completed },
                new NarrationStageView{ Kind = NarrationStageKind.Lore, Status = NarrationStageStatus.Pending },
                new NarrationStageView{ Kind = NarrationStageKind.Llm, Status = NarrationStageStatus.Pending }
            ),
            Output = new NarrationOutputView{ IsStreaming = true, StreamedSegments = ImmutableArray.Create("You let your gaze ", "drift across the room...") }
        }
    };

    private Task OnSubmit(string text) => Task.CompletedTask;
}
